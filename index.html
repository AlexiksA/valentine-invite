<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine's invitation for pookie</title>
    <style>
        body { margin: 0; background: #ffeef2; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        
        /* Ecran Start */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; background: #ffeef2;
        }

        /* Ecran Final */
        #win-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; align-items: center; justify-content: center;
            z-index: 9999; background: rgba(255, 238, 242, 0.95);
        }

        .card { 
            background: white; padding: 2rem; border-radius: 25px; 
            box-shadow: 0 10px 30px rgba(214, 51, 132, 0.2); text-align: center; 
            max-width: 320px; width: 90%;
        }

        canvas { display: none; background: #87CEEB; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }
        
        .btn { padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; margin: 10px; display: inline-block; }
        #yesBtn { background: #ff4d6d; color: white; }
        #noBtn { background: #6c757d; color: white; position: relative; }

        #controls { 
            position: fixed; bottom: 20px; width: 100%; 
            display: none; justify-content: space-around; z-index: 5000; 
            pointer-events: none;
        }
        .control-btn { 
            width: 65px; height: 65px; background: white; 
            border: 3px solid #ff4d6d; border-radius: 50%; font-size: 1.5rem;
            display: flex; align-items: center; justify-content: center;
            pointer-events: auto;
            user-select: none;
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <div class="card">
            <h1>Do you wanna be my valentine? ‚ù§Ô∏è</h1>
            <button id="yesBtn" class="btn" onclick="launchGame()">DA!</button>
            <button id="noBtn" class="btn" onmouseover="runAway()" ontouchstart="runAway()">NU</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div style="display: flex; gap: 15px;">
            <div class="control-btn" id="lB">‚¨ÖÔ∏è</div>
            <div class="control-btn" id="rB">‚û°Ô∏è</div>
        </div>
        <div class="control-btn" id="jB">‚¨ÜÔ∏è</div>
    </div>

    <div id="win-screen">
        <div class="card">
            <h1>M ai gasit ‚ù§Ô∏è</h1>
            <p>Esti regina meaüòçüòç. Te iubesc enorm!</p>
            <button class="btn" onclick="location.reload()" style="font-size: 0.9rem; background: #ff4d6d; color: white;">Joaca din nou</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const pImg = new Image(); 
        pImg.src = "ada.png";
        const qImg = new Image(); 
        qImg.src = "eu.png";

        let gameRunning = false;
        let p, q, plats, traps, enemies, camX, inputs, ground;
        let jumpPressed = false;

        function runAway() {
            const b = document.getElementById('noBtn');
            b.style.position = 'fixed';
            b.style.left = Math.random() * 70 + 10 + '%';
            b.style.top = Math.random() * 70 + 10 + '%';
        }

        function launchGame() {
            // Ascunde UI-ul de start
            document.getElementById('start-screen').style.display = 'none';
            canvas.style.display = 'block';
            
            // SeteazƒÉ dimensiunile canvas
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ground = canvas.height - 100;
            
            // ActiveazƒÉ controalele pe mobil
            if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                document.getElementById('controls').style.display = 'flex';
            }

            // Ini»õializeazƒÉ variabilele de joc
            inputs = { left: false, right: false, up: false };
            camX = 0;
            jumpPressed = false;
            
            p = { 
                x: 50, 
                y: ground - 50, 
                w: 100, 
                h: 100, 
                dx: 0, 
                dy: 0, 
                speed: 6, 
                grav: 0.6, 
                jump: -14, 
                onG: true 
            };
            
            q = { 
                x: 4000, 
                y: ground - 60, 
                w: 80, 
                h: 80 
            };
            
            // Platforme mai variate
            plats = [];
            for(let i = 0; i < 20; i++) {
                plats.push({ 
                    x: 400 + (i * 220), 
                    y: ground - (60 + Math.random() * 180), 
                    w: 80 + Math.random() * 60, 
                    h: 15 
                });
            }
            
            // Mai multe capcane
            traps = [];
            // Capcane pe pƒÉm√¢nt
            for(let i = 0; i < 15; i++) {
                traps.push({ 
                    x: 600 + (i * 280), 
                    y: ground - 30, 
                    w: 30, 
                    h: 30 
                });
            }
            // Capcane pe platforme
            plats.forEach((plt, idx) => {
                if(idx % 3 === 0 && idx > 2) {
                    traps.push({
                        x: plt.x + plt.w/2 - 15,
                        y: plt.y - 30,
                        w: 30,
                        h: 30
                    });
                }
            });

            // Du»ômani simpli care merg √Ænainte »ôi √Ænapoi
            enemies = [];
            for(let i = 0; i < 5; i++) {
                enemies.push({
                    x: 1000 + (i * 700),
                    y: ground - 40,
                    w: 40,
                    h: 40,
                    speed: 2,
                    dir: 1,
                    minX: 1000 + (i * 700) - 100,
                    maxX: 1000 + (i * 700) + 100
                });
            }

            gameRunning = true;
            loop();
        }

        // Event Listeners pentru tastaturƒÉ
        window.addEventListener('keydown', e => {
            if(!gameRunning) return;
            if(e.code === 'ArrowLeft' || e.code === 'KeyA') inputs.left = true;
            if(e.code === 'ArrowRight' || e.code === 'KeyD') inputs.right = true;
            if(e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') {
                if(!jumpPressed) {
                    inputs.up = true;
                    jumpPressed = true;
                }
            }
        });
        
        window.addEventListener('keyup', e => {
            if(e.code === 'ArrowLeft' || e.code === 'KeyA') inputs.left = false;
            if(e.code === 'ArrowRight' || e.code === 'KeyD') inputs.right = false;
            if(e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') {
                inputs.up = false;
                jumpPressed = false;
            }
        });

        // Event Listeners pentru controale mobile
        function bind(id, k) {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { 
                e.preventDefault(); 
                inputs[k] = true; 
            });
            el.addEventListener('touchend', (e) => { 
                e.preventDefault(); 
                inputs[k] = false; 
            });
            el.addEventListener('mousedown', (e) => { 
                e.preventDefault(); 
                inputs[k] = true; 
            });
            el.addEventListener('mouseup', (e) => { 
                e.preventDefault(); 
                inputs[k] = false; 
            });
        }
        
        bind('lB', 'left'); 
        bind('rB', 'right'); 
        bind('jB', 'up');

        function checkCollision(a, b) {
            return a.x < b.x + b.w &&
                   a.x + a.w > b.x &&
                   a.y < b.y + b.h &&
                   a.y + a.h > b.y;
        }

        function resetPlayer() {
            p.x = 50;
            p.y = ground - 50;
            p.dx = 0;
            p.dy = 0;
            camX = 0;
        }

        function loop() {
            if(!gameRunning) return;

            // ActualizeazƒÉ du»ômanii
            enemies.forEach(enemy => {
                enemy.x += enemy.speed * enemy.dir;
                
                // SchimbƒÉ direc»õia la limite
                if(enemy.x <= enemy.minX || enemy.x >= enemy.maxX) {
                    enemy.dir *= -1;
                }
            });

            // CalculeazƒÉ viteza (√ÆncetinitƒÉ de capcane)
            let s = p.speed;
            let inTrap = false;
            traps.forEach(t => {
                if(checkCollision(p, t)) {
                    s = 1.5;
                    inTrap = true;
                }
            });

            // VerificƒÉ coliziune cu du»ômanii
            enemies.forEach(enemy => {
                if(checkCollision(p, enemy)) {
                    resetPlayer();
                }
            });

            // Mi»ôcare orizontalƒÉ
            if(inputs.left) p.dx = -s;
            else if(inputs.right) p.dx = s;
            else p.dx = 0;

            // SƒÉriturƒÉ - FIXED
            if(inputs.up && p.onG) { 
                p.dy = p.jump;
                p.onG = false;
            }

            // AplicƒÉ mi»ôcarea orizontalƒÉ
            p.x += p.dx;

            // Gravita»õie
            p.dy += p.grav;
            
            // AplicƒÉ mi»ôcarea verticalƒÉ
            p.y += p.dy;

            // ReseteazƒÉ onGround √Ænainte de verificƒÉri
            let wasOnGround = p.onG;
            p.onG = false;

            // VerificƒÉ coliziunea cu podeaua
            if(p.y + p.h >= ground) { 
                p.y = ground - p.h; 
                p.dy = 0; 
                p.onG = true; 
            }

            // VerificƒÉ coliziunea cu platformele
            plats.forEach(pl => {
                // Doar dacƒÉ cade (dy >= 0) »ôi vine de sus
                if(p.dy >= 0 && 
                   p.x + p.w > pl.x && 
                   p.x < pl.x + pl.w && 
                   p.y + p.h >= pl.y && 
                   p.y + p.h <= pl.y + pl.h + 10) {
                    p.y = pl.y - p.h; 
                    p.dy = 0; 
                    p.onG = true;
                }
            });

            // LimiteazƒÉ la st√¢nga
            if(p.x < 0) p.x = 0;

            // CamerƒÉ urmƒÉre»ôte jucƒÉtorul
            camX = p.x - canvas.width / 3;
            if(camX < 0) camX = 0;

            // Randare
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // DeseneazƒÉ fundalul cu nori
            ctx.fillStyle = "#87CEEB";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Nori simpli
            ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
            for(let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.arc(100 + i * 300 - (camX * 0.5) % 1500, 80 + i * 40, 40, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.save();
            ctx.translate(-camX, 0);

            // DeseneazƒÉ platformele
            ctx.fillStyle = "#ffb3c1"; 
            ctx.strokeStyle = "#ff8fab";
            ctx.lineWidth = 3;
            plats.forEach(pl => {
                ctx.fillRect(pl.x, pl.y, pl.w, pl.h);
                ctx.strokeRect(pl.x, pl.y, pl.w, pl.h);
            });
            
            // DeseneazƒÉ capcanele (spini)
            traps.forEach(t => {
                ctx.fillStyle = "#e74c3c";
                ctx.beginPath();
                ctx.moveTo(t.x + t.w/2, t.y);
                ctx.lineTo(t.x + t.w, t.y + t.h);
                ctx.lineTo(t.x, t.y + t.h);
                ctx.closePath();
                ctx.fill();
            });
            
            // DeseneazƒÉ du»ômanii
            enemies.forEach(enemy => {
                ctx.fillStyle = "#9b59b6";
                ctx.fillRect(enemy.x, enemy.y, enemy.w, enemy.h);
                
                // Ochi simpli
                ctx.fillStyle = "white";
                ctx.fillRect(enemy.x + 8, enemy.y + 10, 8, 8);
                ctx.fillRect(enemy.x + 24, enemy.y + 10, 8, 8);
                ctx.fillStyle = "black";
                ctx.fillRect(enemy.x + 10, enemy.y + 12, 4, 4);
                ctx.fillRect(enemy.x + 26, enemy.y + 12, 4, 4);
            });

            // DeseneazƒÉ pƒÉm√¢ntul
            ctx.fillStyle = "#8d5524"; 
            ctx.fillRect(0, ground, canvas.width + camX + 1000, 100);
            
            // DeseneazƒÉ iarba
            ctx.fillStyle = "#2ecc71"; 
            ctx.fillRect(0, ground, canvas.width + camX + 1000, 10);

            // DeseneazƒÉ jucƒÉtorul
            if(pImg.complete) {
                ctx.drawImage(pImg, p.x, p.y, p.w, p.h);
            } else {
                ctx.fillStyle = "#ff4d6d";
                ctx.fillRect(p.x, p.y, p.w, p.h);
            }

            // DeseneazƒÉ regina
            if(qImg.complete) {
                ctx.drawImage(qImg, q.x, q.y, q.w, q.h);
            } else {
                ctx.fillStyle = "#ffd700";
                ctx.fillRect(q.x, q.y, q.w, q.h);
            }

            // Text indicator dacƒÉ √Æn capcanƒÉ
            if(inTrap) {
                ctx.fillStyle = "red";
                ctx.font = "20px Arial";
                ctx.fillText("√éNCETINIT!", p.x - 20, p.y - 10);
            }

            ctx.restore();

            // Status bar
            ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
            ctx.fillRect(10, 10, 200, 40);
            ctx.fillStyle = "white";
            ctx.font = "16px Arial";
            ctx.fillText(`Distan»õƒÉ: ${Math.floor(p.x)}m`, 20, 35);

            // VerificƒÉ victoria
            if(p.x + p.w >= q.x) {
                gameRunning = false;
                document.getElementById('win-screen').style.display = 'flex';
                document.getElementById('controls').style.display = 'none';
                canvas.style.display = 'none';
            }

            requestAnimationFrame(loop);
        }

        // Redimensionare fereastrƒÉ
        window.addEventListener('resize', () => {
            if(gameRunning) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                ground = canvas.height - 100;
            }
        });
    </script>
</body>
</html>
